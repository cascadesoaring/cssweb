<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <style>
      /* Layout: put images side-by-side */
      .images {
        display: flex;
        gap: 12px;
        align-items: flex-start; /* align tops; we'll sync heights in JS */
      }

      /* Constrain these two images to max 300px by 300px while preserving aspect ratio */
      #windgram,
      #keatcam {
        max-width: 420px;
        max-height: 420px;
        width: auto;
        height: auto;
        display: block;
      }

      /* Ensure keatcam keeps its aspect ratio when we set its height in JS */
      #keatcam {
        width: auto; /* width will adjust when height is set */
      }
    </style>
  </head>
  <body>
    <div class="images">
      <a href="http://wxtofly.net/v2/explorer.html#Chelan" target="_blank"><img id="windgram" alt="Chelan windgram"></a>
      <a href="https://cam.pangbornairport.com/webcam/pawebcam.jpg" target="_blank"><img id="keatcam" alt="Pangborn Airport webcam"></a>
    </div>

    <script>
      // Get today's date
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');

      // Random number for cache-busting
      const rand = Math.floor(Math.random() * 1e8);

      const wxtofly_chelan = `http://wxtofly.net/windgrams/${yyyy}-${mm}-${dd}_Chelan_windgram.png?${rand}`;
      const windgramUrl = `https://images.weserv.nl/?url=${encodeURIComponent(wxtofly_chelan)}`;

      const keatcamUrl = `https://cam.pangbornairport.com/webcam/pawebcam.jpg?${rand}`;
      
      // Set image src
      const windgram = document.getElementById('windgram');
      const keatcam = document.getElementById('keatcam');

      windgram.src = windgramUrl;
      keatcam.src = keatcamUrl;

      // Make keatcam the same height as windgram once windgram's size is known.
      function syncHeights() {
        // Use clientHeight which reflects rendered height (after CSS constraints)
        const h = windgram.clientHeight;
        if (h && !isNaN(h)) {
          keatcam.style.height = h + 'px';
        }
      }

      // Sync when windgram finishes loading
      windgram.addEventListener('load', syncHeights);

      // Also sync when keatcam loads (in case it needs adjustment) and on window resize
      keatcam.addEventListener('load', syncHeights);
      window.addEventListener('resize', () => {
        // small delay to allow layout to stabilize on resize
        setTimeout(syncHeights, 50);
      });

      // Attempt an initial sync in case images are cached and load events already fired
      setTimeout(syncHeights, 100);
    </script>
  </body>
</html>
